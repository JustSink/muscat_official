name: Upload Tracks from Issues

on:
  issue_comment:
    types: [created]

jobs:
  process_track:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Debug info
        run: |
          echo "üîÑ Workflow –∑–∞–ø—É—â–µ–Ω!"
          echo "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π: ${{ github.event.comment.body }}"
          echo "–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${{ github.event.comment.user.login }}"

      - name: Create test file
        run: |
          # –°–æ–∑–¥–∞—ë–º –ø–∞–ø–∫—É –µ—Å–ª–∏ –µ—ë –Ω–µ—Ç
          mkdir -p tracks
          
          # –°–æ–∑–¥–∞—ë–º —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª —Å —É–Ω–∏–∫–∞–ª—å–Ω—ã–º –∏–º–µ–Ω–µ–º
          echo "–¢–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª —Å–æ–∑–¥–∞–Ω –≤ $(date)" > "tracks/test_$(date +%s).txt"
          echo "‚úÖ –°–æ–∑–¥–∞–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª"

      - name: Commit and push changes
        run: |
          # –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º git
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          
          # –î–æ–±–∞–≤–ª—è–µ–º –≤—Å–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
          git add .
          
          # –ö–æ–º–º–∏—Ç–∏–º
          git commit -m "‚úÖ Test: –î–æ–±–∞–≤–ª–µ–Ω —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª –∏–∑ workflow"
          
          # –ü—É—à–∏–º –∏–∑–º–µ–Ω–µ–Ω–∏—è
          git push origin HEAD:main
          echo "üéâ –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–ø—É—à–µ–Ω—ã –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π!"

      - name: Success
        run: echo "‚úÖ Workflow –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞–≤–µ—Ä—à—ë–Ω!"