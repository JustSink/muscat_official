<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Music App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: #222;
            color: white;
            margin: 0;
            padding: 20px;
            text-align: center;
        }
        .greeting {
            font-size: 24px;
            margin: 50px 0;
            color: #4ecdc4;
        }
        .player-container {
            margin: 30px 0;
        }
        .track-list {
            margin: 20px 0;
            text-align: left;
        }
        .track-item {
            padding: 12px;
            margin: 8px 0;
            background: #333;
            border-radius: 8px;
            cursor: pointer;
        }
        .track-item:hover {
            background: #444;
        }
        .track-item.playing {
            background: #4ecdc4;
            color: #222;
        }
        audio {
            width: 100%;
            margin-top: 15px;
        }
        button {
            background: #4ecdc4;
            color: #222;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            margin: 10px 5px;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="greeting">–ü—Ä–∏–≤–µ—Ç! üéµ</div>
    <p>–ú—É–∑—ã–∫–∞–ª—å–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è...</p>

    <div class="player-container">
        <button onclick="loadTracks()">–ü–æ–∫–∞–∑–∞—Ç—å —Ç—Ä–µ–∫–∏</button>
        <div id="track-list" class="track-list"></div>
        <audio id="audio-player" controls></audio>
    </div>

    <script>

        try {
            let tg = window.Telegram.WebApp;
            console.log('Telegram WebApp detected');
            
            tg.ready();
            tg.expand();
            
            console.log('WebApp initialized successfully');
            
        } catch (error) {
            console.log('Not in Telegram environment:', error);
        }

        async function loadTracks() {
            try {

                const response = await fetch('/api/tracks');
                const tracks = await response.json();
                
                const trackList = document.getElementById('track-list');
                trackList.innerHTML = '';
                
                tracks.forEach(track => {
                    const trackElement = document.createElement('div');
                    trackElement.className = 'track-item';
                    trackElement.innerHTML = `
                        <strong>${track.title}</strong> - ${track.artist}
                    `;
                    trackElement.onclick = () => playTrack(track.id);
                    trackList.appendChild(trackElement);
                });
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–µ–∫–æ–≤:', error);
                alert('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ —Ç—Ä–µ–∫–æ–≤');
            }
        }

        async function playTrack(trackId) {
            try {
                const audioPlayer = document.getElementById('audio-player');      
                audioPlayer.src = `/api/play/${track.id}`;
                audioPlayer.load();
                await audioPlayer.play();
                
                document.querySelectorAll('.track-item').forEach(item => {
                    item.classList.remove('playing');
                });
                event.target.classList.add('playing');
                
            } catch (error) {
                console.error('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è:', error);
                alert('–û—à–∏–±–∫–∞ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è —Ç—Ä–µ–∫–∞');
            }
        }

        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded, loading tracks...');
        });
    </script>
</body>
</html>
